<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>基于公众号的微信支付</title>
<meta name="keywords" content="基于公众号的微信支付" />
<meta name="description" content="基于公众号的微信支付" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<link rel="stylesheet" href="../../statics/grace20200720.css" />
<link rel="stylesheet" href="https://at.alicdn.com/t/font_611166_2ypi64205d6.css" />
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript" src="../../statics/grace.js"></script>
</head>
<body>
<div class="grace-header">
	<div class="grace-main">
		<div class="grace-logo">
			<a href="../../index.html"><img src="../../statics/images/logo.png" /></a>
		</div>
		<ul class="grace-nav" id="grace-nav">
								<li><a href="javascript:;" onclick="showDownLoad()">下载</a></li>
								<li><a href="../../doc.html" id="nav-doc">手册</a></li>
			<li><a href="../../tools.html" id="nav-tool">工具</a></li>
			 
		</ul>
	</div>
	<div class="grace-menu" id="grace-menu"><i class="iconfont icon-menu"></i></div>
</div>
<div class="grace-header-line"></div>
<div class="grace-slide-menu" id="slide-menu-account">
	<a href="../../login.html">账户中心</a>
	<a href="../../login.html">我的话题</a>
	<a href="../../login.html">我的评论</a>
	<a href="../../index.html">退出系统</a>
</div>
<style type="text/css">@media screen and (max-width:800px){
	.grace-rows1{display:none;}
	.grace-rows2{width:94%; padding:5px 2%;}
}
</style>
<div class="grace-line-banner"></div>
<div class="grace-main grace-margin-top">
	<div class="grace-rows1 grace-l">
		<div class="grace-accordion" id="grace-accordion">
	<dl id="docdl-0" class="grace-mobile-hide">
		<dt>graceWechat<i class="iconfont icon-jt-down"></i></dt>
		<dd class="grace-mobile-hide"><a href="../../wechat.html" id="doc-menu-0-0">graceWechat 介绍</a></dd>
	</dl>
	<dl id="docdl-1">
		<dt>微信公众号常用<i class="iconfont icon-jt-down"></i></dt>
		<dd><a href="328-1.html" id="doc-menu-1-328">公众号开发资料</a></dd>
		<dd><a href="329-1.html" id="doc-menu-1-329">快速接入公众号</a></dd>
		<dd><a href="330-1.html" id="doc-menu-1-330">关注、取消关注</a></dd>
		<dd><a href="331-1.html" id="doc-menu-1-331">接收、回复消息</a></dd>
		<dd><a href="332-1.html" id="doc-menu-1-332">消息数据日志</a></dd>
		<dd><a href="333-1.html" id="doc-menu-1-333">综合消息处理</a></dd>
		<dd><a href="334-1.html" id="doc-menu-1-334">Access Token</a></dd>
		<dd><a href="335-1.html" id="doc-menu-1-335">自定义菜单</a></dd>
		<dd><a href="336-1.html" id="doc-menu-1-336">临时素材管理</a></dd>
		<dd><a href="337-1.html" id="doc-menu-1-337">二维码生成及识别</a></dd>
		<dd><a href="338-1.html" id="doc-menu-1-338">长链转短链</a></dd>
		<dd><a href="339-1.html" id="doc-menu-1-339">模板消息</a></dd>
		<dd><a href="340-1.html" id="doc-menu-1-340">获取用户信息</a></dd>
	</dl>
	<dl id="docdl-2">
		<dt>网页开发及授权<i class="iconfont icon-jt-down"></i></dt>
		<dd><a href="341-2.html" id="doc-menu-2-341">前端框架推荐</a></dd>
		<dd><a href="342-2.html" id="doc-menu-2-342">微信网页授权</a></dd>
		<dd><a href="../../tools/info/17.html" target="_blank">微信扫码登录</a></dd>
		<dd><a href="343-2.html" id="doc-menu-2-343">微信JS-SDK调用</a></dd>
	</dl>
	<dl id="docdl-3">
		<dt>微信支付<i class="iconfont icon-jt-down"></i></dt>
		<dd><a href="https://pay.weixin.qq.com/wiki/doc/api/index.html" target="_blank">微信支付手册</a></dd>
		<dd><a href="344-3.html" id="doc-menu-3-344">公众号内支付</a></dd>
		<dd><a href="345-3.html" id="doc-menu-3-345">微信扫码支付</a></dd>
		<dd><a href="346-3.html" id="doc-menu-3-346">H5+ APP支付</a></dd>
		<dd><a href="347-3.html" id="doc-menu-3-347">微信小程序支付</a></dd>
	</dl>
	<dl id="docdl-4">
		<dt>小程序<i class="iconfont icon-jt-down"></i></dt>
		<dd><a href="348-4.html" id="doc-menu-4-348">小程序code换opennid</a></dd>
	</dl>
</div>
<script type="text/javascript">
function buyGraceWechat(){
	var gDialog = new graceDialog();
	gDialog.buttons = ['关闭', '知道了'];
	gDialog.alert('请联系客服 QQ 1265928288 购买【价格 ￥299】');
}
</script>	</div>
	<div class="grace-rows2 grace-r">
		<div style="line-height:2em; border-bottom:1px solid #F6F6F6; padding-bottom:12px;">
			<h1 class="grace-h3 grace-color-green">基于公众号的微信支付</h1>
		</div>
		<div class="grace-content" style="padding:22px 0px;">
			<p><strong>1、设置支付目录</strong></p><p>在微信公众平台设置您的公众号支付支付目录，设置见下图。公众号支付在请求支付的时候会校验请求来源是否有在公众平台做了配置，所以必须确保支付目录已经正确的被配置，否则将验证失败，请求支付不成功。<br/>网址 :&nbsp;<a href="https://pay.weixin.qq.com/index.php/extend/pay_setting" target="_blank" title="https://pay.weixin.qq.com/index.php/extend/pay_setting">https://pay.weixin.qq.com/index.php/extend/pay_setting</a></p><p><img src="../../statics/images/201805/1525750172831409.png" title="1525750131880848.png" alt="1.png"/><br/><strong>重要说明</strong><br/>如果您的支付地址为 www.***.com/wx/pay那么支付目录应为www.***.com/wx/<br/>最后一个目录，以 / 结尾！否则会报错 : &quot;URL 未注册&quot;！<br/><br/></p><p><strong>2、设置授权域名</strong><br/></p><p>开发公众号支付时还需要使用 jssdk , 请在公众号内正确设置 js 安全域名！<br/><br/></p><p><strong>完整演示代码 - 前端 : &nbsp;wx_pay.php</strong><br/></p><pre class="brush:php;toolbar:false">&lt;!DOCTYPE&nbsp;html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;
&lt;meta&nbsp;name=&quot;viewport&quot;&nbsp;content=&quot;initial-scale=1.0,&nbsp;maximum-scale=1.0,&nbsp;user-scalable=no&quot;&nbsp;/&gt;
&lt;title&gt;微信支付测试&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;微信支付测试&lt;/h1&gt;
&lt;div&nbsp;style=&quot;padding:28px;&nbsp;padding-bottom:0px;&nbsp;line-height:28px;&nbsp;text-align:center;&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;点击下面按钮会调用微信支付，支付1元！
&lt;/div&gt;
&lt;div&nbsp;style=&quot;padding:28px;&quot;&gt;&lt;button&nbsp;type=&quot;button&quot;&nbsp;class=&quot;&quot;&nbsp;id=&quot;btn1&quot;&gt;立即支付&lt;/button&gt;&lt;/div&gt;
&lt;script&nbsp;type=&quot;text/javascript&quot;&nbsp;src=&quot;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;?php
$gracewechat&nbsp;=&nbsp;tool(&#39;graceWeChat&#39;);
$jsConfig&nbsp;=&nbsp;$gracewechat-&gt;getJsTicket();
?&gt;
&lt;script&nbsp;type=&quot;text/javascript&quot;&nbsp;src=&quot;http://res.wx.qq.com/open/js/jweixin-1.2.0.js&quot;&gt;&lt;/script&gt;
&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;
wx.config({
&nbsp;&nbsp;&nbsp;&nbsp;debug:&nbsp;false,
&nbsp;&nbsp;&nbsp;&nbsp;appId:&nbsp;&#39;&lt;?php&nbsp;echo&nbsp;$gracewechat-&gt;appId;?&gt;&#39;,&nbsp;//&nbsp;必填，公众号的唯一标识
&nbsp;&nbsp;&nbsp;&nbsp;timestamp:&nbsp;&lt;?php&nbsp;echo&nbsp;$jsConfig[&quot;timestamp&quot;];?&gt;,
&nbsp;&nbsp;&nbsp;&nbsp;nonceStr:&nbsp;&#39;&lt;?php&nbsp;echo&nbsp;$jsConfig[&quot;nonceStr&quot;];?&gt;&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;signature:&nbsp;&#39;&lt;?php&nbsp;echo&nbsp;$jsConfig[&quot;signature&quot;];?&gt;&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;jsApiList:&nbsp;[&#39;chooseWXPay&#39;]
});
&lt;/script&gt;
&lt;script&nbsp;type=&quot;text/javascript&quot;&gt;
$(&#39;#btn1&#39;).click(function(){
&nbsp;&nbsp;&nbsp;&nbsp;$.getJSON(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;/wx/order&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function(res){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(res);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!res.paySign){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(&#39;微信支付失败，请重试！&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//发起微信支付
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WeixinJSBridge.invoke(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;getBrandWCPayRequest&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;appId&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;res.appId,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;timeStamp&quot;&nbsp;&nbsp;&nbsp;:&nbsp;res.timeStamp,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;nonceStr&quot;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;res.nonceStr,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;package&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;res.package,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;signType&quot;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&quot;MD5&quot;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;paySign&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;res.paySign
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function(res){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(res.err_msg&nbsp;==&nbsp;&quot;get_brand_wcpay_request:ok&quot;){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(&#39;支付成功，感谢您的支持！&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if(res.err_msg&nbsp;==&nbsp;&quot;get_brand_wcpay_request:cancel&quot;){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(&#39;您取消了支付&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if(res.err_msg&nbsp;==&nbsp;&quot;get_brand_wcpay_request:fail&quot;){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(&#39;支付失败&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;);
});
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p><br/><strong>后端 - 统一下单接口<br/></strong>请打开 graceWechat.php，正确填写以下配置 :<br/></p><pre class="brush:php;toolbar:false">//公众号开发配置
define(&#39;GWECHAT_appId&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;***&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//公众号appId
define(&#39;GWECHAT_APPSECRET&#39;,&nbsp;&nbsp;&nbsp;&#39;***&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//公众号APPSECRET

//微信支付[&nbsp;公众号内支付&nbsp;]&nbsp;需要的配置
define(&#39;GWECHAT_WXPAY_MCHID&#39;,&nbsp;&nbsp;&#39;******&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//微信支付对应的商户ID
define(&#39;GWECHAT_WXPAY_KEY&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&#39;******&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//微信支付对应的秘钥</pre><p><br/>后端代码 :&nbsp;<br/></p><pre class="brush:php;toolbar:false">&lt;?php
class&nbsp;wxController&nbsp;extends&nbsp;grace{
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;index(){}
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;pay(){}
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;order(){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;微信支付后端示例代码
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;模拟一个1元的支付信息，真实环境可以利用订单数据来产生下面的order数据
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//模拟一个简单的订单信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$order&nbsp;=&nbsp;array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&#39;100&#39;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//订单号码
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;price&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//订单价格
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//使用统一下单接口返回微信支付前端必须的信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay&nbsp;=&nbsp;array();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay[&#39;body&#39;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&#39;test...&#39;;&nbsp;//支付描述
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay[&#39;out_trade_no&#39;]&nbsp;=&nbsp;time().$order[&#39;id&#39;];&nbsp;//商户系统内部订单号，要求32个字符内
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay[&#39;total_fee&#39;]&nbsp;&nbsp;=&nbsp;$order[&#39;price&#39;];&nbsp;//总价，需要&nbsp;*&nbsp;100
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay[&#39;notify_url&#39;]&nbsp;&nbsp;&nbsp;=&nbsp;&#39;http://www.phpgrace.com/wx/payback/&#39;;&nbsp;//异步接收微信支付结果通知的回调地址
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$orderWxPay[&#39;openid&#39;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&#39;ousKUxLX36V7c0yizEQnAWnQsRCk&#39;;&nbsp;//客户的openid&nbsp;公众号支付必须参数，通过登录即可获取
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//实例化微信支付对象
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$gracewechat&nbsp;=&nbsp;tool(&#39;graceWeChat&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//生成订单并返回支付必须的信息
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$gracewechat-&gt;createOrder($orderWxPay);
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p><br/><strong>异步通知接口&nbsp;$gracewechat-&gt;payBack()</strong><br/>$gracewechat-&gt;payBack() 会对异步通知的信息进行检查，检查无误后返回数组形式的支付信息。</p><pre class="brush:php;toolbar:false">&lt;?php
class&nbsp;wxController&nbsp;extends&nbsp;grace{
	public&nbsp;function&nbsp;index(){
	
	}
	//......
	public&nbsp;function&nbsp;payback(){
		$gracewechat&nbsp;=&nbsp;tool(&#39;graceWeChat&#39;);
		//生成订单并返回支付必须的信息
		$res&nbsp;=&nbsp;$gracewechat-&gt;payBack();
		//将&nbsp;res&nbsp;数组与数据库内订单信息进行比对，比对后进行后续操作，如：更新订单、发送通知......
	}	</pre><p><br/><strong>payBack() 检查无误后返回数组形式：</strong><br/></p><pre class="brush:php;toolbar:false">{
&quot;return_code&quot;:&quot;SUCCESS&quot;,
&quot;return_msg&quot;:&quot;OK&quot;,
&quot;appid&quot;:&quot;******&quot;,
&quot;mch_id&quot;:&quot;******&quot;,
&quot;nonce_str&quot;:&quot;nrMzODXynJF553vy&quot;,
&quot;sign&quot;:&quot;*****&quot;,
&quot;result_code&quot;:&quot;SUCCESS&quot;,
&quot;openid&quot;:&quot;ousKUxLX36V7c0yizEQnAWnQsRCk&quot;,
&quot;is_subscribe&quot;:&quot;Y&quot;,
&quot;trade_type&quot;:&quot;JSAPI&quot;,
&quot;bank_type&quot;:&quot;CFT&quot;,
&quot;total_fee&quot;:&quot;1&quot;,
&quot;fee_type&quot;:&quot;CNY&quot;,
&quot;transaction_id&quot;:&quot;4200000120201805085218270402&quot;,
&quot;out_trade_no&quot;:&quot;1525761696100&quot;,
&quot;attach&quot;:[],
&quot;time_end&quot;:&quot;20180508144147&quot;,
&quot;trade_state&quot;:&quot;SUCCESS&quot;,
&quot;cash_fee&quot;:&quot;1&quot;,
&quot;trade_state_desc&quot;:&quot;\u652f\u4ed8\u6210\u529f&quot;
}</pre>		</div>
	</div>
</div>
<div class="grace-footer-line"></div>
<div class="grace-footer">
	phpGrace 轻快的实力派！&nbsp;&nbsp;
	<br/>
</div>
<script type="text/javascript">
function showDownLoad(){
	var gDialog = new graceDialog();
	gDialog.buttons = ['关闭', '知道了'];
	var msg = '<a href="https://gitee.com/liukuaizhuan/phpgrace" target="_blank" style="color:#5FB878; font-weight:700;"> 请点击这里去 gitee 下载 phpGrace ^_^</a>'+
			"<br /> 有gitee 账户的同学<br />请给我们一个星星作为鼓励谢谢 ^_^<br />" ;
	gDialog.alert(msg);
}
$('#grace-menu').click(function(){
	var nav = $('#grace-nav');
	if(nav.is(':hidden')){nav.slideDown(100);}else{nav.slideUp(100);}
});
//百度统计
//粘贴代码
</script><script type="text/javascript">
var index = $('#docdl-3').index();
$('#grace-accordion').accordion(index);
$('#doc-menu-3-344').addClass('grace-current');
</script>
<script type="text/javascript" src="http://apps.bdimg.com/libs/prettify/r298/prettify.js"></script>
<script type="text/javascript">
$('pre').addClass('prettyprint');
$('table').each(function(){
	$(this).find('tr:even').find('td').css({background:'#F6F7F8'});
});
prettyPrint();
$('#nav-wx').addClass('grace-current');
</script>
</body>
</html><script>console.log("phpGrace Log : 控制器 : wechat, 方法 : info - 运行时间 : 40.62毫秒, 占用内存 : 42.77k");</script>